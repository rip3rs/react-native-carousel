var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _bullets=_interopRequireDefault(require("./options/bullets"));var _arrows=_interopRequireDefault(require("./options/arrows"));var _jsxFileName="/Users/rip3rs/Documents/work/personal/react-native-carousel/src/carousel.js";var Carousel=function(_Component){(0,_inherits2.default)(Carousel,_Component);function Carousel(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Carousel);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Carousel)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.scrollView=null;_this.state=_this.initState();_this.total=_this.props.children?_this.props.children.length||1:0;_this.playerTimeOutIsOn=false;_this.dimensions={width:_reactNative.Dimensions.get('window').width,height:_reactNative.Dimensions.get('window').height};_this.onPageSelectedHandler=function(e){_this.calcIndex(e.nativeEvent.position);};_this.onPageScrollStateHandler=function(e){var currentRunningPageEndTimer;var _this$props=_this.props,loop=_this$props.loop,children=_this$props.children;switch(true){case e==='dragging':_this.playerTimeOutIsOn=false;clearTimeout(_this.playerTimeOut);break;case e==='idle'&&!_this.playerTimeOutIsOn&&loop:if(currentRunningPageEndTimer){clearTimeout(currentRunningPageEndTimer);}currentRunningPageEndTimer=setTimeout(function(){_this.loop();},parseInt(children[_this.state.index-1].attr.runningtime)*1000);break;}};_this.loop=function(){_this.playerTimeOutIsOn=true;var _this$props2=_this.props,loopTimer=_this$props2.loopTimer,children=_this$props2.children;var index=_this.state.index;var nextChild=children[index>_this.total?0:index-1];var time='attr'in nextChild?parseInt(nextChild.attr.runningtime)*1000:loopTimer*1000;_this.playerTimeOut=setTimeout(function(){clearTimeout(_this.playerTimeOut);_this.calcIndex(index+1);},time);};_this.calcIndex=function(i){var animated=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index=i;var loopJump=false;if(i<=0){index=_this.total;loopJump=true;}else if(i>_this.total){index=1;loopJump=true;}_this.setState((0,_objectSpread2.default)({},_this.state,{index:index,loopJump:loopJump}),function(){return _this.loopJump(animated);});if(_this.playerTimeOutIsOn)_this.loop();};_this.loopJump=function(animated){var _this$state=_this.state,index=_this$state.index,loopJump=_this$state.loopJump;_this.scrollView[!loopJump?'setPage':'setPageWithoutAnimation'](index);};_this.scrollBy=function(i){var index=_this.state.index;var newIndex=i+index;if(_this.total<2)return;_this.calcIndex(newIndex,true);};_this.pageType=function(page,i){var children=_this.props.children;var index=_this.state.index;if(!_react.default.isValidElement(children[page[0]])&&children[page[0]].constructor===Object&&'attr'in children[page[0]]){return _react.default.createElement(_reactNative.View,{key:i,__source:{fileName:_jsxFileName,lineNumber:141}},children[page[0]].attr.isVideo===true&&page[1]!==index?_react.default.createElement(_reactNative.View,{style:styles.videoNotLoaded,__source:{fileName:_jsxFileName,lineNumber:143}}):children[page[0]].component);}else{return _react.default.createElement(_reactNative.View,{key:i,__source:{fileName:_jsxFileName,lineNumber:150}},children[page[0]]);}};return _this;}(0,_createClass2.default)(Carousel,[{key:"initState",value:function initState(){var children=this.props.children;return{index:1,loopJump:false};}},{key:"componentDidMount",value:function componentDidMount(){if(this.total>1&&this.props.loop)this.loop();}},{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.playerTimeOut);}},{key:"render",value:function render(){var _this2=this;var _this$props3=this.props,children=_this$props3.children,margin=_this$props3.margin,bullets=_this$props3.bullets,arrows=_this$props3.arrows,swipe=_this$props3.swipe;var index=this.state.index;var indexes=[];var pages=[]||{};indexes=children.reduce(function(p,n,i){p.push(i);return p;},[]);indexes.unshift(this.total-1);indexes.push(0);indexes=indexes.map(function(index,i){return[index,i];});pages=indexes.map(function(page,i){return _this2.pageType(page,i);});return _react.default.createElement(_reactNative.View,{style:[styles.container],__source:{fileName:_jsxFileName,lineNumber:174}},_react.default.createElement(_reactNative.ViewPagerAndroid,{ref:function ref(_ref){return _this2.scrollView=_ref;},initialPage:index,scrollEnabled:swipe,onPageSelected:this.onPageSelectedHandler,onPageScrollStateChanged:this.onPageScrollStateHandler,key:_react.default.Children.count(indexes),pageMargin:margin,style:[styles.wrapperAndroid],__source:{fileName:_jsxFileName,lineNumber:175}},pages),bullets&&this.total>1?_react.default.createElement(_bullets.default,{index:index,total:this.total,calcIndexHandler:this.calcIndex,__source:{fileName:_jsxFileName,lineNumber:189}}):null,arrows?_react.default.createElement(_arrows.default,{dimensions:this.dimensions,scrollByHandler:this.scrollBy,__source:{fileName:_jsxFileName,lineNumber:191}}):null);}}]);return Carousel;}(_react.Component);Carousel.defaultProps={swipe:true,loop:true,arrows:true,bullets:true,loopTimer:15,margin:0};var _default=Carousel;exports.default=_default;var styles={container:{backgroundColor:'transparent',position:'relative',flex:1,height:'100%',width:'100%',display:'flex',justifyContent:'center',alignItems:'center'},wrapperAndroid:{height:'100%',width:'100%',display:'flex',justifyContent:'center',alignItems:'center'},videoNotLoaded:{flex:1,height:'100%',width:'100%',backgroundColor:'#000000'}};